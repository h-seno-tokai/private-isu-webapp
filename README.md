# Private ISU WebApp Performance Tuning

## ベンチマーク結果

### 初期スコア
以下はアプリケーションの初期状態でのベンチマーク結果です．

- **スコア**: 171
- **成功リクエスト数**: 568
- **失敗リクエスト数**: 22
- **エラーメッセージ**:
  - リクエストがタイムアウトしました (GET /)
  - リクエストがタイムアウトしました (POST /login)
  - リクエストがタイムアウトしました (POST /register)

---

### 最終スコア
以下はパフォーマンス改善後のベンチマーク結果です．

- **スコア**: 376
- **成功リクエスト数**: 2501
- **失敗リクエスト数**: 246
- **エラーメッセージ**:
  - 1ページに表示される画像の数が足りません (GET /)
  - 1ページに表示される画像の数が足りません (GET /posts)
  - リクエストがタイムアウトしました (GET /posts)

---

## 総括

1. **改善内容の概要**:
   - ページングを導入して，投稿データの取得時に一度に大量のデータを処理しないようにしました．
     - クエリに `LIMIT` と `OFFSET` を追加．
     - ページごとに20件ずつ投稿を取得する仕様に変更．
   - SQL クエリで使用するパラメータを明示的に整数型にキャストするよう修正．
   - 上記の変更により，メモリ不足エラーを解消しました．

2. **課題と学び**:
   - プログラムをみて，データベースで直接画像のバイナリーデータを扱うのはいかがなものかと考えました．パスを保存しておいて，画像はファイルとして保存する方が良いのではないかと思いました．しかし，sql/dump.sql をVScodeで開こうとすると，ファイルサイズが大きすぎるために変更がままならないことがありました．調べると，MYSQLのインタラクティブモードを使うと，ファイルサイズが大きくても編集が可能だということがわかりました．少し難しそうだったので，PHPファイルの変更だけで対応することにしました．
   - ポストメソッドの処理を変更する効率的かと考え，ページングを導入するに至りました．しかし，dockerのメモリ不足とのエラーが出てしまい，dockerfileの変更により，メモリ制限を増やすのは想定されていないのかなと考え，他の方法を探しました．そこで，ページごとに20件ずつ投稿を取得する仕様に変更し，メモリ不足エラーを解消しました．
   

